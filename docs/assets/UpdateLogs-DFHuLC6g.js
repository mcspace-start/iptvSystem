import{_ as Ce,r as n,N as Ve,O as ze,c as S,b as l,w as t,k as Se,W as Ee,m,l as $,a as E,o as w,y as xe,z as ke,d as o,G as Le,F,s as A,H as Ue,Z as Be,e as Me,g as Pe,T as Re,U as $e,p as Ie,j as d,t as I,i as qe,E as Ne,x as Oe,v as We,a5 as Ye,D as He,X as je,A as D,M as Fe}from"./index-DMhmhxta.js";/* empty css                 *//* empty css                 *//* empty css                        *//* empty css                      *//* empty css                  *//* empty css               *//* empty css                       */const Ae={class:"update-logs"},Ge={class:"card-header"},Xe={class:"tool-bar"},Ze={class:"card-body"},Je={class:"dialog-title"},Ke={class:"dialog-content"},Qe={class:"dialog-footer"},he={class:"dialog-title"},el={class:"dialog-content"},ll={class:"dialog-footer"},tl={class:"dialog-title"},al={class:"dialog-content"},ol={class:"info"},sl={class:"print"},nl={class:"print-logs"},ul={class:"dialog-footer"},il="/updateLogs",rl="/deletelogs",dl="/deleteRangelogs",pl="/deletelog",gl={__name:"UpdateLogs",setup(vl){const x=n("all"),K=[{value:"all",label:"全部"},{value:"iptv",label:"更新直播源"},{value:"static_iptv",label:"静态更新直播源"},{value:"epg",label:"更新EPG"},{value:"tvb",label:"更新TVB直播源"}],k=n("all"),Q=[{value:"all",label:"全部"},{value:"success",label:"成功"},{value:"failed",label:"失败"},{value:"pending",label:"进行中"}],u=n({currentPage:1,pageSize:10,total:0,layout:"total, sizes, prev, pager, next, jumper"}),h=Ve("xs");ze(()=>{h.value?u.value.layout="pager":u.value.layout="total, sizes, prev, pager, next, jumper"});const L=n({currentPage:1,pageSize:10,total:0}),ee=()=>{f()},le=()=>{f()},i=n({startTime:"",endTime:""}),te=()=>{i.value.endTime=""},ae=s=>i.value.startTime?!(i.value.startTime<s):!0,oe=()=>{i.value.startTime&&i.value.endTime&&f()},G=()=>{f()},q=n([]),_=n(!1),se=s=>({success:"success",error:"danger",pending:"info"})[s.status]||"info",X=s=>({success:"成功",error:"失败",pending:"进行中"})[s.status]||"未知",f=async()=>{if(_.value)return m.info("请等待上次请求完成");_.value=!0;const s={type:x.value,status:k.value,startTime:i.value.startTime||"",endTime:i.value.endTime||"",page:u.value.currentPage,size:u.value.pageSize};try{const e=await $.get(il,{params:s});e.code==200?(u.value.total=e.data.total,L.value={...u.value},q.value=e.data.logs):(m.error(e.msg),u.value={...L.value})}catch(e){u.value={...L.value},m.error(e.msg),console.log(e)}finally{_.value=!1}};f();const N=s=>{if(!s)return"YYYY-MM-DD HH:mm:ss";const e=new Date(s),B=e.getFullYear(),M=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0"),T=String(e.getHours()).padStart(2,"0"),P=String(e.getMinutes()).padStart(2,"0"),R=String(e.getSeconds()).padStart(2,"0");return`${B}-${M}-${p} ${T}:${P}:${R}`},ne=()=>{_.value||(i.value={startTime:"",endTime:""},x.value="all",k.value="all",q.value=[],u.value={currentPage:1,pageSize:10,total:0},L.value={currentPage:1,pageSize:10,total:0},f())},C=n(!1),O=n(!1),U=n(30),ue=()=>{C.value=!0,U.value=30},ie=async()=>{if(_.value)return;O.value=!0;const s={days:U.value};try{const e=await $.get(rl,{params:s});e.code===200?(D.success({title:"删除日志成功！",showClose:!1}),C.value=!1,f()):(m.error(e.msg),D.error({title:"删除日志失败！",showClose:!1}))}catch(e){m.error(e.msg||"删除日志失败！"),console.log(e)}finally{O.value=!1}},V=n(!1),r=n({startTime:"",endTime:""}),W=n(!1),re=()=>{V.value=!0,r.value.startTime="",r.value.endTime=""},de=s=>r.value.startTime?s<r.value.startTime:!0,pe=async()=>{if(_.value)return;if(!r.value.startTime||!r.value.endTime)return m.info("请选择日期范围！");W.value=!0;const s={starTime:r.value.startTime.getTime(),endTime:r.value.endTime.getTime()};try{const e=await $.get(dl,{params:s});e.code===200?(D.success({title:"删除日志成功！",showClose:!1}),V.value=!1,await f()):(m.error(e.msg),D.error({title:"删除日志失败！",showClose:!1}))}catch(e){m.error(e.msg),console.log(e)}finally{W.value=!1}},z=n(!1),Y=n(!1),g=n({}),ge=s=>{z.value=!0,g.value=s},ve=()=>{_.value||Fe.confirm("确定删除该日志吗?","删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"error",confirmButtonClass:"el-button--danger"}).then(async()=>{Y.value=!0;const s={id:g.value.id};try{const e=await $.get(pl,{params:s});e.code===200?(D.success({title:"删除日志成功！",showClose:!1}),z.value=!1,await f()):(m.error(e.msg),D.error({title:"删除日志失败！",showClose:!1}))}catch(e){m.error(e.msg||"删除日志失败！"),console.log(e)}finally{Y.value=!1}}).catch(()=>{})};return(s,e)=>{const B=Ue,M=Le,p=ke,T=Be,P=xe,R=Se,Z=E("Refresh"),c=Ne,v=qe,me=E("Calendar"),fe=E("Delete"),y=$e,_e=Ie,ce=E("View"),ye=Oe,be=Re,Te=Ye,H=E("Warning"),b=He,j=Ee,we=je,De=We;return w(),S("main",Ae,[l(R,null,{default:t(()=>[l(P,{gutter:20,class:"main-header"},{default:t(()=>[l(p,{xs:24,sm:12,md:6},{default:t(()=>[e[15]||(e[15]=o("p",{class:"title"},"更新类型：",-1)),l(M,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),placeholder:"Select",size:"large",onChange:G},{default:t(()=>[(w(),S(F,null,A(K,a=>l(B,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1,__:[15]}),l(p,{xs:24,sm:12,md:6},{default:t(()=>[e[16]||(e[16]=o("p",{class:"title"},"更新状态：",-1)),l(M,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),placeholder:"Select",size:"large",onChange:G},{default:t(()=>[(w(),S(F,null,A(Q,a=>l(B,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1,__:[16]}),l(p,{xs:24,sm:12,md:6},{default:t(()=>[e[17]||(e[17]=o("p",{class:"title"},"起始日期：",-1)),l(T,{modelValue:i.value.startTime,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.startTime=a),type:"date",placeholder:"选择日期",size:"large",style:{width:"100%"},onChange:te},null,8,["modelValue"])]),_:1,__:[17]}),l(p,{xs:24,sm:12,md:6},{default:t(()=>[e[18]||(e[18]=o("p",{class:"title"},"结束日期：",-1)),l(T,{modelValue:i.value.endTime,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.endTime=a),type:"date",placeholder:"选择日期",size:"large",style:{width:"100%"},disabled:!i.value.startTime,"disabled-date":ae,onChange:oe},null,8,["modelValue","disabled"])]),_:1,__:[18]})]),_:1})]),_:1}),l(R,{class:"update-logs-list","body-style":{padding:0}},{header:t(()=>[o("div",Ge,[e[22]||(e[22]=o("span",{class:"title hidden-xs-only"},"更新日志列表",-1)),o("div",Xe,[l(v,{type:"info",size:"large",plain:"",onClick:ne},{icon:t(()=>[l(c,null,{default:t(()=>[l(Z)]),_:1})]),default:t(()=>[e[19]||(e[19]=d(" 重置筛选条件",-1))]),_:1,__:[19]}),l(v,{type:"danger",size:"large",plain:"",onClick:re},{icon:t(()=>[l(c,null,{default:t(()=>[l(me)]),_:1})]),default:t(()=>[e[20]||(e[20]=d("按日期删除日志",-1))]),_:1,__:[20]}),l(v,{type:"danger",size:"large",plain:"",onClick:ue},{icon:t(()=>[l(c,null,{default:t(()=>[l(fe)]),_:1})]),default:t(()=>[e[21]||(e[21]=d(" 清理旧日志",-1))]),_:1,__:[21]})])])]),footer:t(()=>[l(Te,{background:"","current-page":u.value.currentPage,"onUpdate:currentPage":e[4]||(e[4]=a=>u.value.currentPage=a),"page-size":u.value.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>u.value.pageSize=a),"page-sizes":[10,20,30],layout:u.value.layout,total:u.value.total,onSizeChange:ee,onCurrentChange:le,"pager-count":5},null,8,["current-page","page-size","layout","total"])]),default:t(()=>[o("div",Ze,[Me((w(),Pe(be,{data:q.value,style:{width:"100%"}},{empty:t(()=>[l(ye,{"image-size":100,class:"table-empty",description:"暂无数据"})]),default:t(()=>[l(y,{prop:"id",label:"ID","min-width":"60"}),l(y,{prop:"update_type",label:"更新类型","min-width":"120"}),l(y,{align:"center",prop:"status",label:"状态",width:"90"},{default:t(({row:a})=>[l(_e,{type:se(a),size:"large"},{default:t(()=>[d(I(X(a)),1)]),_:2},1032,["type"])]),_:1}),l(y,{label:"开始时间","min-width":"220"},{default:t(({row:a})=>[d(I(N(a.start_time)),1)]),_:1}),l(y,{prop:"duration",label:"耗时(秒)",width:"80"}),l(y,{prop:"created_by",label:"操作人","show-overflow-tooltip":""}),l(y,{label:"操作",width:"120"},{default:t(({row:a})=>[l(v,{type:"primary",plain:"",onClick:J=>ge(a)},{default:t(()=>[l(c,{class:"icon-eye"},{default:t(()=>[l(ce)]),_:1}),e[23]||(e[23]=d(" 查看",-1))]),_:2,__:[23]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[De,_.value]])])]),_:1}),l(j,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=a=>C.value=a),title:"Tips","align-center":"",class:"my-dialog danger",width:"500"},{header:t(()=>[o("div",Je,[l(c,{size:20},{default:t(()=>[l(H)]),_:1}),e[24]||(e[24]=o("span",null,"清理旧日志",-1))])]),footer:t(()=>[o("div",Qe,[l(v,{onClick:e[7]||(e[7]=a=>C.value=!1)},{default:t(()=>e[28]||(e[28]=[d("取消",-1)])),_:1,__:[28]}),l(v,{type:"danger",onClick:ie,loading:O.value},{default:t(()=>e[29]||(e[29]=[d("确认清理",-1)])),_:1,__:[29]},8,["loading"])])]),default:t(()=>[o("div",Ke,[e[25]||(e[25]=o("p",null,"您可以清理指定天数前的日志记录以节省存储空间。",-1)),e[26]||(e[26]=o("p",{class:"label"},"保留最近天数的日志:",-1)),l(b,{size:"large",type:"number",modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=a=>U.value=a),placeholder:"请输入天数",min:"1",max:"365"},null,8,["modelValue"]),e[27]||(e[27]=o("p",{class:"desc"}," 设置为30表示保留最近30天的日志，删除30天前的所有日志。 ",-1))])]),_:1},8,["modelValue"]),l(j,{modelValue:V.value,"onUpdate:modelValue":e[12]||(e[12]=a=>V.value=a),title:"Tips",width:"500","align-center":"",class:"my-dialog danger"},{header:t(()=>[o("div",he,[l(c,{size:20},{default:t(()=>[l(H)]),_:1}),e[30]||(e[30]=o("span",null,"按日期范围删除日志",-1))])]),footer:t(()=>[o("div",ll,[l(v,{onClick:e[11]||(e[11]=a=>V.value=!1)},{default:t(()=>e[35]||(e[35]=[d("取消",-1)])),_:1,__:[35]}),l(v,{type:"danger",onClick:pe,loading:W.value},{default:t(()=>e[36]||(e[36]=[d(" 确认 ",-1)])),_:1,__:[36]},8,["loading"])])]),default:t(()=>[o("div",el,[l(we,{type:"warning",closable:!1},{default:t(()=>e[31]||(e[31]=[d(" 警告: 此操作将删除指定日期范围内的所有日志记录，且不可恢复。",-1)])),_:1,__:[31]}),e[32]||(e[32]=o("p",{class:"label"},"开始日期:",-1)),l(T,{modelValue:r.value.startTime,"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.startTime=a),type:"date",placeholder:"年/月/日",size:"large",style:{width:"100%"},"popper-options":s.popperOptions},null,8,["modelValue","popper-options"]),e[33]||(e[33]=o("p",{class:"label"},"结束日期:",-1)),l(T,{modelValue:r.value.endTime,"onUpdate:modelValue":e[10]||(e[10]=a=>r.value.endTime=a),type:"date",placeholder:"年/月/日",size:"large",style:{width:"100%"},placement:"top",disabled:!r.value.startTime,"disabled-date":de},null,8,["modelValue","disabled"]),e[34]||(e[34]=o("p",{class:"desc"},"将删除从开始日期到结束日期期间（含）的所有日志记录。",-1))])]),_:1},8,["modelValue"]),l(j,{modelValue:z.value,"onUpdate:modelValue":e[14]||(e[14]=a=>z.value=a),title:"Tips","align-center":"",class:"my-dialog primary dialog-max-height",width:"70%"},{header:t(()=>[o("div",tl,[l(c,{size:20},{default:t(()=>[l(H)]),_:1}),o("span",null,"更新日志详情(ID:"+I(g.value.id)+")",1)])]),footer:t(()=>[o("div",ul,[l(v,{type:"danger",onClick:ve,loading:Y.value},{default:t(()=>e[44]||(e[44]=[d(" 删除 ",-1)])),_:1,__:[44]},8,["loading"]),l(v,{type:"primary",onClick:e[13]||(e[13]=a=>z.value=!1)},{default:t(()=>e[45]||(e[45]=[d("关闭",-1)])),_:1,__:[45]})])]),default:t(()=>[o("div",al,[o("div",ol,[l(P,{gutter:20},{default:t(()=>[l(p,{xs:24,span:12},{default:t(()=>[e[37]||(e[37]=o("p",{class:"info-label"},"更新类型:",-1)),l(b,{readonly:"",value:g.value.update_type},null,8,["value"])]),_:1,__:[37]}),l(p,{xs:24,span:12},{default:t(()=>[e[38]||(e[38]=o("p",{class:"info-label"},"开始时间:",-1)),l(b,{readonly:"",value:N(g.value.start_time)},null,8,["value"])]),_:1,__:[38]}),l(p,{xs:24,span:12},{default:t(()=>[e[39]||(e[39]=o("p",{class:"info-label"},"状态:",-1)),l(b,{readonly:"",value:X(g.value)},null,8,["value"])]),_:1,__:[39]}),l(p,{xs:24,span:12},{default:t(()=>[e[40]||(e[40]=o("p",{class:"info-label"},"结束时间:",-1)),l(b,{readonly:"",value:N(g.value.end_time)},null,8,["value"])]),_:1,__:[40]}),l(p,{xs:24,span:12},{default:t(()=>[e[41]||(e[41]=o("p",{class:"info-label"},"操作人:",-1)),l(b,{readonly:"",value:g.value.created_by},null,8,["value"])]),_:1,__:[41]}),l(p,{xs:24,span:12},{default:t(()=>[e[42]||(e[42]=o("p",{class:"info-label"},"耗时:",-1)),l(b,{readonly:"",value:g.value.duration+"秒"},null,8,["value"])]),_:1,__:[42]})]),_:1})]),o("div",sl,[e[43]||(e[43]=o("p",{class:"print-title"},"日志内容:",-1)),o("div",nl,[(w(!0),S(F,null,A(g.value.logs,(a,J)=>(w(),S("p",{class:"log-text",key:J},I(a),1))),128))])])])]),_:1},8,["modelValue"])])}}},Dl=Ce(gl,[["__scopeId","data-v-9f71679b"]]);export{Dl as default};
