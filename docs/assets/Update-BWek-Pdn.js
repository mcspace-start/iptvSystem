import{_ as G,r as v,$ as N,c as g,b as t,w as l,k as U,a as y,o as h,d as e,t as r,j as F,G as I,F as T,s as E,H as M,i as O,E as R,u as j,f as q,a8 as A,l as H,A as w,m as J}from"./index-DMhmhxta.js";/* empty css                    *//* empty css                  */const K={class:"main"},Q={class:"executor"},W={class:"msg"},X={class:"progress hidden-xs-only"},Y={class:"card-body"},Z={class:"print-title"},ee={class:"time"},te={class:"msg"},se={__name:"Update",setup(ae){const u={iptv:{title:"更新直播源",desc:"此功能将从IPTV服务器获取最新的直播源数据，并更新系统中的频道列表。",executor:"/opt/iptv/scripts/python/iptv",url:"/update"},static_iptv:{title:"静态更新直播源",desc:"此功能将使用预设的静态直播源配置，生成新的频道列表文件。",executor:"/opt/iptv/scripts/python/static_iptv",url:"/update"},epg:{title:"更新EPG",desc:"此功能将从互联网获取最新的节目指南数据(EPG)，并更新系统中的节目信息。",executor:"/opt/iptv/scripts/python/epg",url:"/update"},tvb:{title:"更新TVB直播源",desc:"此功能将更新TVB频道的直播源数据，包括最新的频道信息和播放地址。",executor:"/opt/iptv/scripts/python/tvb",url:"/update"}},n=v("iptv"),S=[{value:"iptv",label:"更新直播源"},{value:"static_iptv",label:"静态更新直播源"},{value:"epg",label:"更新EPG"},{value:"tvb",label:"更新TVB直播源"}],f=v("开始更新"),p=v(!1),s=N({percentage:0,indeterminate:!1,duration:3,status:""}),c=v([]),V=()=>{p.value=!0,f.value="更新中...",s.percentage=100,s.indeterminate=!0},B=()=>{p.value=!1,f.value="开始更新",s.percentage=100,s.indeterminate=!1},C={iptv:"/update",static_iptv:"/update",epg:"/update",tvb:"/update"},k=async()=>{V(),c.value.push({time:`[${new Date().toLocaleTimeString()}]`,msg:`🏃开始${u[n.value].title} ...`});const b=new Date().getTime(),a=C[n.value];try{const d=((new Date().getTime()-b)/1e3).toFixed(1),_=await H.get(a);_.code===200?((_.data.logs||[]).forEach(m=>{c.value.push({time:"[--:--:--]",msg:m})}),c.value.push({time:`[${new Date().toLocaleTimeString()}]`,msg:`✅更新成功！ - 耗时${d}秒`}),w.success({message:"更新成功！",showClose:!1}),s.status="success"):(w.error({message:"更新失败！",showClose:!1}),c.value.push({time:`[${new Date().toLocaleTimeString()}]`,msg:`❌更新失败！ - 耗时${d}秒`}))}catch(i){J.error("请求错误，详情查看控制台！"),c.value.push({time:`[${new Date().toLocaleTimeString()}]`,msg:"🌐❌🔗请求错误!"}),console.log(`update:请求错误!
`,i)}finally{B(),s.status="exception"}},$=()=>{c.value=[]};return(b,a)=>{const i=U,d=M,_=I,x=y("Refresh"),m=R,D=O,L=q,P=y("Tickets"),z=A;return h(),g("div",K,[t(i,{class:"alert-card"},{default:l(()=>[e("h4",null,"关于"+r(u[n.value].title),1),e("p",null,[F(r(u[n.value].desc)+" ",1),e("span",Q,r(u[n.value].executor),1)])]),_:1}),t(i,{class:"update-card"},{header:l(()=>a[1]||(a[1]=[e("div",{class:"card-header"},[e("span",{style:{"font-weight":"bold"}},"更新状态")],-1)])),default:l(()=>[e("div",W,[t(_,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=o=>n.value=o),placeholder:"请选择",size:"large",onChange:$},{default:l(()=>[(h(),g(T,null,E(S,o=>t(d,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),t(D,{class:"update-button",size:"large",type:"primary",onClick:k,disabled:p.value},{default:l(()=>[t(m,{size:16,class:j({updating:p.value})},{default:l(()=>[t(x)]),_:1},8,["class"]),e("span",null,r(f.value),1)]),_:1},8,["disabled"]),e("div",X,[t(L,{status:s.status,percentage:s.percentage,indeterminate:s.indeterminate,"show-text":!1,duration:s.duration},null,8,["status","percentage","indeterminate","duration"])])])]),_:1}),t(i,{class:"log-card","body-style":{padding:0}},{header:l(()=>a[2]||(a[2]=[e("div",{class:"card-header"},[e("span",{style:{"font-weight":"bold"}},"更新日志")],-1)])),default:l(()=>[t(z,{"max-height":"300px"},{default:l(()=>[e("ul",Y,[e("li",Z,[t(m,{class:"icon",size:16},{default:l(()=>[t(P)]),_:1}),a[3]||(a[3]=e("span",{class:"msg"},"更新过程将显示在这里",-1))]),(h(!0),g(T,null,E(c.value,o=>(h(),g("li",{key:o},[e("span",ee,r(o.time),1),e("p",te,r(o.msg),1)]))),128))])]),_:1})]),_:1})])}}},ce=G(se,[["__scopeId","data-v-b31df3e4"]]);export{ce as default};
